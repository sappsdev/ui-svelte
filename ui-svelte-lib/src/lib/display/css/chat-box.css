@layer components {
	.chatbox {
		@apply relative flex h-full w-full flex-col overflow-hidden rounded-ui;
		@apply bg-surface;
	}

	.chatbox.is-prompt {
		@apply bg-background;
	}

	.chatbox-header {
		@apply flex items-center justify-between gap-3 border-b border-muted px-4 py-3;
		@apply bg-background text-on-background;
	}

	.chatbox-header-start {
		@apply flex items-center gap-3;
	}

	.chatbox-header-center {
		@apply flex flex-1 flex-col items-start gap-0.5;
	}

	.chatbox-header-name {
		@apply text-sm font-semibold leading-none text-on-surface;
	}

	.chatbox-header-status {
		@apply text-xs leading-none text-on-muted;
	}

	.chatbox-header-end {
		@apply flex items-center gap-2;
	}

	.chatbox-messages {
		@apply flex flex-1 flex-col gap-2 overflow-y-auto px-4 py-4;
		@apply bg-surface;
	}

	.chatbox.is-prompt .chatbox-messages {
		@apply gap-4 bg-background;
	}

	.chatbox-messages::-webkit-scrollbar {
		@apply w-1.5;
	}

	.chatbox-messages::-webkit-scrollbar-track {
		@apply bg-transparent;
	}

	.chatbox-messages::-webkit-scrollbar-thumb {
		@apply rounded-full bg-muted/30;
	}

	.chatbox-messages::-webkit-scrollbar-thumb:hover {
		@apply bg-muted/50;
	}

	.message-wrapper {
		@apply flex w-full;
		animation: messageSlideIn 0.2s ease-out;
	}

	.message-wrapper.own {
		@apply justify-end;
	}

	.message-wrapper:not(.own) {
		@apply justify-start;
	}

	.chatbox.is-prompt .message-wrapper {
		@apply gap-3;
	}

	.chatbox.is-prompt .message-wrapper.assistant {
		@apply justify-start;
	}

	.chatbox.is-prompt .message-wrapper.own {
		@apply flex-row-reverse;
	}

	.chatbox.is-prompt .message-wrapper.system {
		@apply justify-center;
	}

	.message-avatar {
		@apply shrink-0;
	}

	@keyframes messageSlideIn {
		from {
			opacity: 0;
			transform: translateY(0.5rem);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.message {
		@apply relative max-w-[70%] rounded-2xl px-3 py-2;
		@apply text-sm leading-relaxed;
	}

	.message:not(.own) {
		@apply rounded-bl-md bg-surface text-on-surface;
	}

	.message.own {
		@apply rounded-br-md;
	}

	.chatbox.is-prompt .message {
		@apply max-w-none flex-1 rounded-2xl px-4 py-3;
	}

	.chatbox.is-prompt .message.assistant {
		@apply rounded-tl-md bg-surface;
	}

	.chatbox.is-prompt .message.own {
		@apply rounded-tr-md;
	}

	.chatbox.is-prompt .message.system {
		@apply max-w-fit rounded-full bg-muted/20 px-4 py-2 text-xs text-on-muted;
	}

	.message-content {
		@apply mb-1 whitespace-pre-wrap wrap-break-word leading-relaxed;
	}

	.streaming-cursor {
		@apply ml-0.5 inline-block animate-pulse text-primary;
	}
	.typing-indicator {
		@apply flex items-center gap-1 py-1;
	}

	.typing-indicator span {
		@apply h-2 w-2 rounded-full bg-on-muted/50;
		animation: typingBounce 1.4s infinite ease-in-out both;
	}

	.typing-indicator span:nth-child(1) {
		animation-delay: -0.32s;
	}

	.typing-indicator span:nth-child(2) {
		animation-delay: -0.16s;
	}

	@keyframes typingBounce {
		0%,
		80%,
		100% {
			transform: scale(0.8);
			opacity: 0.5;
		}
		40% {
			transform: scale(1);
			opacity: 1;
		}
	}

	.message-meta {
		@apply flex items-center justify-end gap-1;
	}

	.message-time {
		@apply text-[10px] opacity-70;
	}

	.message-status {
		@apply text-xs opacity-80;
	}

	.message-status-read {
		@apply text-info;
	}

	.message-image {
		@apply mb-1 block max-w-full rounded-lg;
	}

	.message-file {
		@apply flex items-center gap-2 py-1;
	}

	.message-file-icon {
		@apply text-xl;
	}

	.message-file-name {
		@apply text-sm;
	}

	.chatbox.is-solid {
		&.is-primary .message.own {
			@apply bg-primary text-on-primary;
		}
		&.is-secondary .message.own {
			@apply bg-secondary text-on-secondary;
		}
		&.is-muted .message.own {
			@apply bg-on-muted text-muted;
		}
		&.is-success .message.own {
			@apply bg-success text-on-success;
		}
		&.is-info .message.own {
			@apply bg-info text-on-info;
		}
		&.is-warning .message.own {
			@apply bg-warning text-on-warning;
		}
		&.is-danger .message.own {
			@apply bg-danger text-on-danger;
		}
	}

	.chatbox.is-soft {
		&.is-primary .message.own {
			@apply bg-on-primary text-primary;
		}
		&.is-secondary .message.own {
			@apply bg-on-secondary text-secondary;
		}
		&.is-muted .message.own {
			@apply bg-muted text-on-muted;
		}
		&.is-success .message.own {
			@apply bg-on-success text-success;
		}
		&.is-info .message.own {
			@apply bg-on-info text-info;
		}
		&.is-warning .message.own {
			@apply bg-on-warning text-warning;
		}
		&.is-danger .message.own {
			@apply bg-on-danger text-danger;
		}
	}

	.chatbox.is-outlined {
		&.is-primary .message.own {
			@apply border border-primary bg-transparent text-primary;
		}
		&.is-secondary .message.own {
			@apply border border-secondary bg-transparent text-secondary;
		}
		&.is-muted .message.own {
			@apply border border-on-muted bg-transparent text-on-muted;
		}
		&.is-success .message.own {
			@apply border border-success bg-transparent text-success;
		}
		&.is-info .message.own {
			@apply border border-info bg-transparent text-info;
		}
		&.is-warning .message.own {
			@apply border border-warning bg-transparent text-warning;
		}
		&.is-danger .message.own {
			@apply border border-danger bg-transparent text-danger;
		}
	}

	.chatbox.is-prompt.is-solid,
	.chatbox.is-prompt.is-soft,
	.chatbox.is-prompt.is-outlined {
		& .message.assistant {
			@apply bg-surface text-on-surface;
		}
	}

	.chatbox-footer {
		@apply border-t border-surface text-on-background p-2;
	}

	.chatbox.is-prompt .chatbox-footer {
		@apply border-t border-muted/30 bg-background;
	}

	.chatbox-input {
		@apply appearance-none w-full h-full outline-none bg-transparent;
	}

	.chatbox-input-wrapper {
		@apply flex items-center gap-2 bg-background rounded-ui p-2;
		box-shadow: 0 0 3px 0 var(--color-muted);
	}

	.chatbox.is-prompt .chatbox-input-wrapper {
		@apply bg-surface;
	}

	.chatbox-input-actions {
		@apply flex items-center gap-1;
	}

	.chatbox-record-overlay {
		@apply absolute inset-x-0 bottom-0 z-10;
		@apply border-t border-muted bg-surface/95 backdrop-blur-sm;
		@apply px-4 py-3;
	}

	.load-more-btn {
		@apply mx-auto mb-2 block rounded-full px-4 py-2 text-xs font-medium;
		@apply bg-surface text-on-surface shadow-sm transition-all;
		@apply hover:shadow-md;
		@apply disabled:cursor-not-allowed disabled:opacity-50;
	}
}
